<mt:setvarblock name="page_title"><__trans phrase="Export Theme"></mt:setvarblock>
<mt:setvar name="export_theme" value="1">
<mt:setvarblock name="html_head" append="1">
<script type="text/javascript" src="<mt:var name="static_uri">js/tc/client.js"></script>
<script type="text/javascript" src="<mt:var name="static_uri">js/dialog.js"></script>
</mt:setvarblock>
<mt:setvarblock name="system_msg">
    <div id="msg-block">
    <mt:if name="save_success">
        <mtapp:statusmsg
            id="saved-theme"
            class="success">
            <__trans phrase="Theme package have been saved.">
        </mtapp:statusmsg>
    </mt:if>
    </div>
</mt:setvarblock>
<mt:include name="include/header.tmpl">
<form id="theme_settings" method="post" enctype="multipart/form-data" action="<mt:var name="script_url">">
<input type="hidden" name="__mode" value="do_export_theme" />
<input type="hidden" name="blog_id" value="<mt:var name="blog_id">" />
<input type="hidden" name="magic_token" value="<mt:var name="magic_token">" />
<input type="hidden" name="theme_class" value="<mt:var name="theme_class" />" />
<input type="hidden" name="output" value="<mt:var name="output" />" />

<fieldset>

    <mtapp:setting
       id="theme-name-field"
       label="<__trans phrase="Theme name">"
       hint="<__trans phrase="The name of your theme.">">
       <input type="text" name="theme_name" id="theme_name" value="<mt:var name="theme_name" escape="html">" />
    </mtapp:setting>

    <mtapp:setting
       id="theme-id-field"
       label="<__trans phrase="Basename">"
       show_hint="1"
       hint="<__trans phrase="Use letters, numbers, dash or underscore only (a-z, A-Z, 0-9, '-' or '_').">">
       <input type="text" name="theme_id" id="theme_id" value="<mt:var name="theme_id" escape="html">" />
    </mtapp:setting>

    <mtapp:setting
       id="theme-author-name-field"
       label="<__trans phrase="Author name">"
       hint="<__trans phrase="The author of this theme.">">
       <input type="text" name="theme_author_name" id="theme_author_name" value="<mt:var name="theme_author_name" escape="html">" />
    </mtapp:setting>

    <mtapp:setting
       id="theme-author-link-field"
       label="<__trans phrase="Author link">"
       hint="<__trans phrase="The author's website.">">
      <input type="text" name="theme_author_link" id="theme_author_link" value="<mt:var name="theme_author_link" escape="html">" />
    </mtapp:setting>

    <mtapp:setting
       id="theme-version-field"
       label="<__trans phrase="Theme version">"
       hint="<__trans phrase="A version number for this theme.">">
       <input type="text" name="theme_version" id="theme_version" class="smaller-text" value="<mt:var name="theme_version" escape="html">" />
    </mtapp:setting>

    <mtapp:setting
       id="theme-description-field"
       label="<__trans phrase="Theme description">"
       hint="<__trans phrase="A description for this theme.">">
       <textarea name="description" id="description"><mt:var name="description" escape="html"></textarea>
    </mtapp:setting>

    <mtapp:setting
        id="theme-options-field"
        label="<__trans phrase="Theme options">"
        hint="<__trans phrase="Additional assets to be included in the theme.">"
        content_class="field-content-text">
        <ul>
        <mt:loop name="exporters">
            <li>
                <label for="<mt:var name="id">-include"><input type="checkbox" id="<mt:var name="id">-include" name="include" value="<mt:var name="id">" onclick="toggleActive('<mt:var name="id">-detail')" <mt:if name="included">checked="checked"</mt:if>> <mt:var name="label"></label>
                <span id="<mt:var name="id">-detail" class="theme-option-detail <mt:unless name="include"> active</mt:unless>">
                    <a href="javascript:openDetailDialog('<mt:var name="id">');"><__trans phrase="Details"></a>
                </span>
            </li>
        </mt:loop>
        </ul>
    </mtapp:setting>
</fieldset>

<mt:loop name="exporters">
<div id="<mt:var name="id">" class="panel" style="display: none;">
    <h3><__trans phrase="Setting for [_1]" params="<mt:var name="label">"></h3>
    <div id="<mt:var name="id">-setting"></div>
</div>
</mt:loop>

<mt:setvarblock name="action_buttons">
<button
    type="submit"
    accesskey="s"
    title="<__trans phrase="Export Theme">"
    class="export action primary-button"
    ><__trans phrase="Export Theme"></button>
</mt:setvarblock>
<mt:include name="include/actions_bar.tmpl" bar_position="bottom" hide_pager="1" settings_bar="1">

</form>
<script type="text/javascript">
/* <![CDATA[ */
jQuery.mtCheckbox();
var settingText;
function openSetting(id) {
    jQuery.fn.mtDialog.open(id); 
}

function openDetailDialog (exporter) {
    jQuery.fn.mtDialog.open(
        '<mt:var name="script_url">', {
            'form': 'theme_settings',
            'param' : {
                '__mode': 'theme_element_detail',
                'exporter': exporter,
                'blog_id': <mt:var name="blog_id">
            }
        }
    );
}

jQuery(function() {
    function is_valid_basename(name) {
        return name.match(/^[a-zA-Z][a-zA-Z0-9_-]*$/);
    }

    jQuery.validator.addMethod('basename', function(value, element) {
        return is_valid_basename(value);
    });

    jQuery('#theme_settings').validate({
        rules: {
            theme_id: {
                'required': true,
                'basename': true
            }
        },    
        messages: {
            theme_id: '<__trans phrase="Basename may only contain letters, numbers, and the dash or underscore character. The basename must begin with a letter." escape="singlequotes">'
        },
        errorClass: "msg-error",
        errorPlacement: function(error, element) {
            element.parents('div.field').addClass('error-field');
            error.removeAttr('generated').insertAfter(element);
        }
    });
});
    <mt:var name="js_include_footer" />
/* ]]> */
</script>
<mt:include name="include/footer.tmpl">
