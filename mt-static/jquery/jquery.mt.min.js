/*
 * Movable Type (r) Open Source (C) 2001-2009 Six Apart, Ltd.
 * This program is distributed under the terms of the
 * GNU General Public License, version 2.
 *
 * $Id:$
 */
(function(d){d.mtAddEdgeClass=function(){d("body *").filter(":first-child").addClass("first-child").end().filter(":last-child").addClass("last-child")};d.mtMenu=function(f){var h={arrow_image:StaticURI+"images/menu-arrow-down.gif"};var g=d.extend(h,f);d(".top-menu > div a").after('<a href="#" class="toggle-button"><img src="'+g.arrow_image+'" /></a>');d(".top-menu .toggle-button").click(function(i){d(this).parents("li.top-menu").toggleClass("top-menu-open");d(this).parents("li.top-menu").find(".sub-menu").toggle();i.preventDefault()})};d.mtSelector=function(f){var h={arrow_image:StaticURI+"images/arrow-down-gray.gif"};var g=d.extend(h,f);d("#system-overview > em").prepend('<a hre="#" class="toggle-button"><img src="'+g.arrow_image+'" /></a>');d("#user-dashboard > em").prepend('<a href="#" class="toggle-button"><img src="'+g.arrow_image+'" /></a>');d("#current-website > em").prepend('<a href="#" class="toggle-button"><img src="'+g.arrow_image+'" /></a>');d("#selector-nav-list li .toggle-button ").click(function(i){d(this).parent("em").parents("#selector-nav").toggleClass("show-selector");i.preventDefault()});d(document).click(function(i){if(d(i.target).parents("#selector-nav").length==0){d("#selector-nav").removeClass("show-selector")}});if(!d.support.style&&!d.support.objectAll){if(d.fn.bgiframe){d("div.selector").bgiframe()}}};d.mtFavActions=function(f){var h={arrow_image:StaticURI+"images/arrow-down-gray.gif"};var g=d.extend(h,f);d(".fav-actions-nav li > em").append('<a href="#" class="toggle-button"><img src="'+g.arrow_image+'" /></a>');d(".fav-actions-nav .toggle-button").click(function(i){d(this).parents("li").toggleClass("active").find(".fav-actions").toggleClass("hidden");i.preventDefault()});d(document).click(function(i){if(d(i.target).parents(".fav-actions-nav").length==0){d(".fav-actions").addClass("hidden").parent("li").removeClass("active")}});if(!d.support.style&&!d.support.objectAll){if(d.fn.bgiframe){d(".fav-action").bgiframe()}}};d.mtCMSSearch=function(f){d("#cms-search > a").click(function(g){d("#cms-search").toggleClass("active").find("#search-form").toggleClass("hidden");g.preventDefault()});d(document).click(function(g){if(d(g.target).parents("#cms-search").length==0){d("#search-form").addClass("hidden").parent("#cms-search").removeClass("active")}});if(!d.support.style&&!d.support.objectAll){if(d.fn.bgiframe){d(".fav-action").bgiframe()}}};d.mtUseSubdomain=function(f){var g=d(".url-field :checkbox");g.each(function(){if(!this.checked){d(this).parents(".field-content").find(".subdomain").hide()}});g.click(function(){if(this.checked){d(this).attr("checked",true).parents(".field-content").find(".subdomain").show()}else{d(this).removeAttr("checked").parents(".field-content").find(".subdomain").hide()}})};d.mtEditSiteUrl=function(f){var i={edit:"Edit"};var h=d.extend(i,f);var g=["site","archive"];d.each(g,function(){var m=this;var j=d("input#"+this+"_url_subdomain");var k=d("input#"+this+"_url_path");var l=j.val();if(l){j.parent(".subdomain").before('<span class="'+this+'_url_subdomain-text"></span>');d("span."+this+"_url_subdomain-text").text(j.val()+".")}j.parents(".field-content").find(".subdomain").hide();j.parents(".field-content").find(".use-subdomain").hide();if(!k.hasClass("show-input")){k.before('<span class="'+this+'_url_path-text"></span>').after('<button id="mt-set-'+this+'_url_path" class="mt-edit-field-button">'+h.edit+"</button>").hide();d("span."+this+"_url_path-text").text(k.val())}if(l&&l.match(/^http/)){j.parents(".field-content").find(".use-subdomain").hide().end().find("span.archive-url-domain").hide().before('<span class="'+this+'_url_path-text">'+j.val()+"</span>");if(d("button#mt-set-"+this+"_url_path").length==0){k.after('<button id="mt-set-'+this+'_url_path" class="mt-edit-field-button">'+h.edit+"</button>").hide()}}d("button#mt-set-"+this+"_url_path").click(function(){d(this).hide();d("span."+m+"_url_subdomain-text").hide();var n=j.val();if(n){j.parents(".field-content").find(".subdomain").show().end().find("span.archive-url-domain").show();if(n.match(/^http/)){j.val("")}}d("span."+m+"_url_path-text").hide();k.show();d(this).parents(".field-content").find(".use-subdomain").show();d("p#"+m+"_url-warning").show();return false})})};d.mtEditSitePath=function(){d(".blog-path-text").each(function(){var f=d(this).val();if(f.match(/^\//)){d(this).removeClass("extra-path").parents(".site-path-field").find("span.website-path").hide()}});d(".blog-path-text").keyup(function(){var f=d(this).val();if(f.match(/^\//)){d(this).removeClass("extra-path").parents(".site-path-field").find("span.website-path").hide()}else{d(this).addClass("extra-path").parents(".site-path-field").find("span.website-path").show()}})};d.mtCheckbox=function(){function f(g){var h=g.find("tbody input:checked").length;if(g.find("tbody :checkbox").length===h){g.find("thead :checkbox, tfoot :checkbox").attr("checked",true)}else{g.find("thead :checkbox, tfoot :checkbox").removeAttr("checked")}}d("thead :checkbox, tfoot :checkbox").click(function(){var g=d(this).parents("table").find(":checkbox");if(this.checked){g.attr("checked",true).parents("tr").addClass("selected").next(".slave").addClass("selected")}else{g.removeAttr("checked").parents("tr").removeClass("selected").next(".slave").removeClass("selected")}});d("tbody :checkbox").click(function(){if(this.checked){d(this).parents("tr").addClass("selected").next(".slave").addClass("selected")}else{d(this).parents("tr").removeClass("selected").next(".slave").removeClass("selected")}f(d(this).parents("table"))});d("tbody").each(function(){d(this).find(":checkbox").parents("tr").removeClass("selected").find("input:checked").parents("tr").addClass("selected");f(d(this).parents("table"))})};d.mtQuickFilter=function(){d("form#list-filter button").hide();d("select.filter-keys").change(function(){d("form#list-filter").submit()})};d.mtDisplayOptions=function(){d("div#display-options-widget").css("position","absolute").hide();if(!d.support.style&&!d.support.objectAll){if(d.fn.bgiframe){d("div#display-options-widget").bgiframe()}}d("a.display-options-link").click(function(){d("a.display-options-link").toggleClass("display-options-link-open");d("div#display-options-widget").toggle();return false});d("button.close-display-options").click(function(f){d("a.display-options-link").removeClass("display-options-link-open");d("div#display-options-widget").hide();return false});d(document).click(function(f){if(d(f.target).parents("#display-options-widget").length==0){d("a.display-options-link").removeClass("display-options-link-open");d("div#display-options-widget").hide()}})};d.fn.mtDialog=function(f){var h={loadingimage:StaticURI+"images/indicator.gif",esckeyclose:true};var g=d.extend(h,f);b();return this.each(function(){d(this).click(function(){c(this.href,g);return false})})};function b(){d(window).resize(function(){e()});var f=d(".mt-dialog");if(!f.length){d("body").append('<div class="mt-dialog"><span>Close</span></div>');d(".mt-dialog").after('<div class="mt-dialog-overlay"></div>');d(".mt-dialog > div > span").click(function(){a()})}}function e(){var g=d(".mt-dialog");var f=d(window).height();if(g.length){g.height(f-60);d("#mt-dialog-iframe").height(f-60)}}function c(f,h){if(h.form){var i=h.param;d("<iframe />").attr({id:"mt-dialog-iframe",name:"mt-dialog-iframe",frameborder:"0",width:"100%"}).load(function(){d(".mt-dialog .loading").remove()}).appendTo(d(".mt-dialog"));e();d("<img />").attr({src:h.loadingimage}).addClass("loading").appendTo(d(".mt-dialog"));var g=d("<form />").attr({id:"mt-dialog-post-form",method:"post",action:f,target:"mt-dialog-iframe"}).append(d("#"+h.form).children().clone()).appendTo(d(".mt-dialog"));d.each(i,function(j,k){g.find("[name="+j+"]").remove();d("<input />").attr({type:"hidden",name:j,value:k}).appendTo(g)});g.submit();g.remove()}else{d("<iframe />").attr({id:"mt-dialog-iframe",frameborder:"0",src:f+"&dialog=1",width:"100%"}).load(function(){d(".mt-dialog .loading").remove()}).appendTo(d(".mt-dialog"));e();d("<img />").attr({src:h.loadingimage}).addClass("loading").appendTo(d(".mt-dialog"))}d("body").addClass("has-dialog");d(".mt-dialog").show();d(".mt-dialog").bind("close",function(k,j){j(k)});d(".mt-dialog-overlay").show();if(h.esckeyclose){d(document).keyup(function(j){if(j.keyCode==27){a()}})}if(!d.support.style&&!d.support.objectAll){if(d.fn.bgiframe){d(".mt-dialog-overlay").bgiframe()}if(d.fn.exFixed){d(".mt-dialog").exFixed()}}}function a(f,g){d("body").removeClass("has-dialog");d(".mt-dialog-overlay").hide();if(g){d(".mt-dialog").trigger("close",g)}d(".mt-dialog").unbind("close");d(".mt-dialog").hide();d("#mt-dialog-iframe").remove();if(f){window.location=f}}d.fn.mtDialog.open=function(g,f){var i={loadingimage:StaticURI+"images/indicator.gif",esckeyclose:true};var h=d.extend(i,f);b();c(g,h)};d.fn.mtDialog.close=function(f,g){a(f,g)};d.fn.mtRebuild=function(f){var h={};var g=d.extend(h,f);d(this).click(function(){window.open(d(this).attr("href"),"rebuild_blog_"+g.blog_id,"width=400,height=400,resizable=yes");return false})};d.fn.mtSetTip=function(f){var h={tip_color:"#aaaaaa"};var g=d.extend(h,f);return this.each(function(){var i=d(this).attr("title");d(this).val(i).css("color",g.tip_color);d(this).focus(function(){if(this.value==i){d(this).val("").css("color","#000")}});d(this).blur(function(){if(d(this).val()==""){d(this).val(i).css("color",g.tip_color)}if(this.value!=i){d(this).css("color","#000")}})})};d.fn.mtPublishItems=function(f){var h={name:null,args:{}};var g=d.extend(h,f);return this.each(function(){d(this).click(function(){doForMarkedInThisWindow(d("#"+g.id)[0],g.singular,g.plural,g.name,g.mode,g.args,g.phrase);return false})})};d.fn.mtSubmitItems=function(f){var h={};var g=d.extend(h,f);return this.each(function(){d(this).click(function(){d("form#"+g.id+" > input[name=__mode]").val("save_entries")})})};d.fn.mtDeleteItems=function(f){var h={};var g=d.extend(h,f);return this.each(function(){d(this).click(function(){doRemoveItems(d("#"+g.id)[0],g.singular,g.plural);return false})})};d.fn.mtEnableUsers=function(f){var h={};var g=d.extend(h,f);return this.each(function(){d(this).click(function(){setObjectStatus(d("#"+g.id)[0],g.plural,g.phrase,1);return false})})};d.fn.mtDisableUsers=function(f){var h={};var g=d.extend(h,f);return this.each(function(){d(this).click(function(){var i=d("#sysadmin")[0];if(i&&i.checked){alert(g.message);i.click();return false}setObjectStatus(d("#"+g.id)[0],g.plural,g.phrase,0);return false})})};d.fn.mtDoPluginAction=function(f){var h={};var g=d.extend(h,f);return this.each(function(){d(this).click(function(){doPluginAction(d("#"+g.id)[0],g.plural,g.phrase);return false})})};d.fn.mtRebasename=function(f){var h={text:"..."};var g=d.extend(h,f);return this.each(function(){var j=d("input#basename");var i=j.hide().val();j.hide().before('<span class="basename-text"></span>');j.parent("span.basename").after('<button id="mt-set-basename" class="mt-edit-field-button">'+g.edit+"</button>");if(g.basename){d("span.basename-text").text(g.basename)}else{d("span.basename-text").text(i||g.text)}d(this).keyup(function(){if(!g.basename){i=dirify(d(this).val());if(g.limit){i=i.substring(0,g.limit)}d("span.basename-text").text(i||g.text);j.val(i)}});d("button#mt-set-basename").click(function(){d(this).hide();d("span.basename-text").hide();d("input#basename").show();return false})})};d.fn.mtEditInput=function(f){var h={save:"Save"};var g=d.extend(h,f);return this.each(function(){var j=d(this).attr("id");var i=d("input#"+j);if(i.val()){i.before('<span class="'+j+'-text"></span>').after('<button id="mt-set-'+j+'" class="mt-edit-field-button">'+g.edit+"</button>").hide();d("span."+j+"-text").text(i.val())}d("button#mt-set-"+j).click(function(){d(this).hide();d("span."+j+"-text").hide();d("input#"+j).show();d("p#"+j+"-warning").show();return false})})};d.fn.mtCheckboxOption=function(){return this.each(function(){var f=d(this).find(":checkbox");var g=f.attr("id");if(!f.attr("checked")){d("div#"+g+"-option").hide()}f.click(function(){d("div#"+g+"-option").toggle()})})};d.fn.mtToggleNext=function(f){var h={click_class:"detail-link",detail_class:"detail"};var g=d.extend(h,f);return this.each(function(){var i=d(this);d("."+g.detail_class).hide();i.find("."+g.click_class).click(function(j){i.toggleClass("active").find("."+g.detail_class).toggle();j.preventDefault()})})}})(jQuery);