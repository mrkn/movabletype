/*
 * Movable Type (r) Open Source (C) 2001-2010 Six Apart, Ltd.
 * This program is distributed under the terms of the
 * GNU General Public License, version 2.
 *
 * $Id$
 */
(function(a){function j(){a(window).resize(function(){h()});if(!a(".mt-dialog").length){a("body").append('<div class="mt-dialog"><span>Close</span></div>');a(".mt-dialog").after('<div class="mt-dialog-overlay"></div>');a(".mt-dialog > div > span").click(function(){i()})}}function h(){var c=a(".mt-dialog"),b=a(window).height();if(c.length){c.height(b-60);a("#mt-dialog-iframe").height(b-60)}}function k(c,b){if(b.form){var d=b.param;a("<iframe />").attr({id:"mt-dialog-iframe",name:"mt-dialog-iframe",
frameborder:"0",width:"100%"}).load(function(){a(".mt-dialog .loading").remove()}).appendTo(a(".mt-dialog"));h();a("<img />").attr({src:b.loadingimage}).addClass("loading").appendTo(a(".mt-dialog"));var e=a("<form />").attr({id:"mt-dialog-post-form",method:"post",action:c,target:"mt-dialog-iframe"}).append(a("#"+b.form).children().clone()).appendTo(a(".mt-dialog"));a.each(d,function(f,g){e.find("[name="+f+"]").remove();a("<input />").attr({type:"hidden",name:f,value:g}).appendTo(e)});e.submit();e.remove()}else{a("<iframe />").attr({id:"mt-dialog-iframe",
frameborder:"0",src:c+"&dialog=1",width:"100%"}).load(function(){a(".mt-dialog .loading").remove()}).appendTo(a(".mt-dialog"));h();a("<img />").attr({src:b.loadingimage}).addClass("loading").appendTo(a(".mt-dialog"))}a("body").addClass("has-dialog");a(".mt-dialog").show();a(".mt-dialog").bind("close",function(f,g){g(f)});a(".mt-dialog-overlay").show();b.esckeyclose&&a(document).keyup(function(f){f.keyCode==27&&i()});if(!a.support.style&&!a.support.objectAll){a.fn.bgiframe&&a(".mt-dialog-overlay").bgiframe();
a.fn.exFixed&&a(".mt-dialog").exFixed()}}function i(c,b){a("body").removeClass("has-dialog");a(".mt-dialog-overlay").hide();b&&a(".mt-dialog").trigger("close",b);a(".mt-dialog").unbind("close");a(".mt-dialog").hide();a("#mt-dialog-iframe").remove();if(c)window.location=c}a.mtAddEdgeClass=function(){a("body *").filter(":first-child").addClass("first-child").end().filter(":last-child").addClass("last-child")};a.mtMenu=function(c){c=a.extend({arrow_image:StaticURI+"images/menu-arrow-down.gif"},c);a(".top-menu > div a").after('<a href="#" class="toggle-button"><img src="'+
c.arrow_image+'" /></a>');a(".top-menu .toggle-button").click(function(b){a(this).parents("li.top-menu").toggleClass("top-menu-open");a(this).parents("li.top-menu").find(".sub-menu").toggle();b.preventDefault()})};a.mtSelector=function(c){c=a.extend({arrow_image:StaticURI+"images/arrow-down-gray.gif"},c);a("#system-overview > em").prepend('<a hre="#" class="toggle-button"><img src="'+c.arrow_image+'" /></a>');a("#user-dashboard > em").prepend('<a href="#" class="toggle-button"><img src="'+c.arrow_image+
'" /></a>');a("#current-website > em").prepend('<a href="#" class="toggle-button"><img src="'+c.arrow_image+'" /></a>');a("#selector-nav-list li .toggle-button ").click(function(b){a(this).parent("em").parents("#selector-nav").toggleClass("show-selector");b.preventDefault()});a(document).click(function(b){a(b.target).parents("#selector-nav").length==0&&a("#selector-nav").removeClass("show-selector")});!a.support.style&&!a.support.objectAll&&a.fn.bgiframe&&a("div.selector").bgiframe()};a.mtFavActions=
function(c){c=a.extend({arrow_image:StaticURI+"images/arrow-down-gray.gif"},c);a(".fav-actions-nav li > em").append('<a href="#" class="toggle-button"><img src="'+c.arrow_image+'" /></a>');a(".fav-actions-nav .toggle-button").click(function(b){a(this).parents("li").toggleClass("active").find(".fav-actions").toggleClass("hidden");b.preventDefault()});a(document).click(function(b){a(b.target).parents(".fav-actions-nav").length==0&&a(".fav-actions").addClass("hidden").parent("li").removeClass("active")});
!a.support.style&&!a.support.objectAll&&a.fn.bgiframe&&a(".fav-action").bgiframe()};a.mtCMSSearch=function(){a("#cms-search > a").click(function(c){a("#cms-search").toggleClass("active").find("#search-form").toggleClass("hidden");c.preventDefault()});a(document).click(function(c){a(c.target).parents("#cms-search").length==0&&a("#search-form").addClass("hidden").parent("#cms-search").removeClass("active")});!a.support.style&&!a.support.objectAll&&a.fn.bgiframe&&a(".fav-action").bgiframe()};a.mtUseSubdomain=
function(){var c=a(".url-field :checkbox");c.each(function(){this.checked||a(this).parents(".field-content").find(".subdomain").hide()});c.click(function(){this.checked?a(this).attr("checked",true).parents(".field-content").find(".subdomain").show():a(this).removeAttr("checked").parents(".field-content").find(".subdomain").hide()})};a.mtEditSiteUrl=function(c){var b=a.extend({edit:"Edit"},c);a.each(["site","archive"],function(){var d=this,e=a("input#"+this+"_url_subdomain"),f=a("input#"+this+"_url_path"),
g=e.val();if(g){e.parent(".subdomain").before('<span class="'+this+'_url_subdomain-text"></span>');a("span."+this+"_url_subdomain-text").text(e.val()+".")}e.parents(".field-content").find(".subdomain").hide();e.parents(".field-content").find(".use-subdomain").hide();if(!f.hasClass("show-input")){f.before('<span class="'+this+'_url_path-text"></span>').after('<button id="mt-set-'+this+'_url_path" class="mt-edit-field-button">'+b.edit+"</button>").hide();a("span."+this+"_url_path-text").text(f.val())}if(g&&
g.match(/^http/)){e.parents(".field-content").find(".use-subdomain").hide().end().find("span.archive-url-domain").hide().before('<span class="'+this+'_url_path-text">'+e.val()+"</span>");a("button#mt-set-"+this+"_url_path").length==0&&f.after('<button id="mt-set-'+this+'_url_path" class="mt-edit-field-button">'+b.edit+"</button>").hide()}a("button#mt-set-"+this+"_url_path").click(function(){a(this).hide();a("span."+d+"_url_subdomain-text").hide();var l=e.val();if(l){e.parents(".field-content").find(".subdomain").show().end().find("span.archive-url-domain").show();
l.match(/^http/)&&e.val("")}a("span."+d+"_url_path-text").hide();f.show();a(this).parents(".field-content").find(".use-subdomain").show();a("p#"+d+"_url-warning").show();return false})})};a.mtEditSitePath=function(){var c=/^(\/|\\\\|[a-zA-Z]:(\\|\/))/;a(".blog-path-text").each(function(){a(this).val().match(c)&&a(this).removeClass("extra-path").parents(".site-path-field").find("span.website-path").hide()});a(".blog-path-text").keyup(function(){a(this).val().match(c)?a(this).removeClass("extra-path").parents(".site-path-field").find("span.website-path").hide():
a(this).addClass("extra-path").parents(".site-path-field").find("span.website-path").show()})};a.mtCheckbox=function(){function c(b){var d=b.find("tbody input:checked").length;b.find("tbody :checkbox").length===d?b.find("thead :checkbox, tfoot :checkbox").attr("checked",true):b.find("thead :checkbox, tfoot :checkbox").removeAttr("checked")}a("thead :checkbox, tfoot :checkbox").click(function(){var b=a(this).parents("table").find(":checkbox");this.checked?b.attr("checked",true).parents("tr").addClass("selected").next(".slave").addClass("selected"):
b.removeAttr("checked").parents("tr").removeClass("selected").next(".slave").removeClass("selected")});a("tbody :checkbox").click(function(){this.checked?a(this).parents("tr").addClass("selected").next(".slave").addClass("selected"):a(this).parents("tr").removeClass("selected").next(".slave").removeClass("selected");c(a(this).parents("table"))});a("tbody").each(function(){a(this).find(":checkbox").parents("tr").removeClass("selected").find("input:checked").parents("tr").addClass("selected");c(a(this).parents("table"))})};
a.mtQuickFilter=function(){a("form#list-filter button").hide();a("select.filter-keys").change(function(){a("form#list-filter").submit()})};a.mtDisplayOptions=function(){a("div#display-options-widget").css("position","absolute").hide();!a.support.style&&!a.support.objectAll&&a.fn.bgiframe&&a("div#display-options-widget").bgiframe();a("a.display-options-link").click(function(){a("a.display-options-link").toggleClass("display-options-link-open");a("div#display-options-widget").toggle();return false});
a("button.close-display-options").click(function(){a("a.display-options-link").removeClass("display-options-link-open");a("div#display-options-widget").hide();return false});a(document).click(function(c){if(a(c.target).parents("#display-options-widget").length==0){a("a.display-options-link").removeClass("display-options-link-open");a("div#display-options-widget").hide()}})};a.fn.mtDialog=function(c){var b=a.extend({loadingimage:StaticURI+"images/indicator.gif",esckeyclose:true},c);j();return this.each(function(){a(this).click(function(){k(this.href,
b);return false})})};a.fn.mtDialog.open=function(c,b){b=a.extend({loadingimage:StaticURI+"images/indicator.gif",esckeyclose:true},b);j();k(c,b)};a.fn.mtDialog.close=function(c,b){i(c,b)};a.fn.mtRebuild=function(c){var b=a.extend({},c);a(this).click(function(){window.open(a(this).attr("href"),"rebuild_blog_"+b.blog_id,"width=400,height=400,resizable=yes");return false})};a.fn.mtSetTip=function(c){var b=a.extend({tip_color:"#aaaaaa"},c);return this.each(function(){var d=a(this).attr("title");a(this).val(d).css("color",
b.tip_color);a(this).focus(function(){this.value==d&&a(this).val("").css("color","#000")});a(this).blur(function(){a(this).val()==""&&a(this).val(d).css("color",b.tip_color);this.value!=d&&a(this).css("color","#000")})})};a.fn.mtPublishItems=function(c){var b=a.extend({name:null,args:{}},c);return this.each(function(){a(this).click(function(){doForMarkedInThisWindow(a("#"+b.id)[0],b.singular,b.plural,b.name,b.mode,b.args,b.phrase);return false})})};a.fn.mtSubmitItems=function(c){var b=a.extend({},
c);return this.each(function(){a(this).click(function(){a("form#"+b.id+" > input[name=__mode]").val("save_entries")})})};a.fn.mtDeleteItems=function(c){var b=a.extend({},c);return this.each(function(){a(this).click(function(){doRemoveItems(a("#"+b.id)[0],b.singular,b.plural);return false})})};a.fn.mtEnableUsers=function(c){var b=a.extend({},c);return this.each(function(){a(this).click(function(){setObjectStatus(a("#"+b.id)[0],b.plural,b.phrase,1);return false})})};a.fn.mtDisableUsers=function(c){var b=
a.extend({},c);return this.each(function(){a(this).click(function(){var d=a("#sysadmin")[0];if(d&&d.checked){alert(b.message);d.click();return false}setObjectStatus(a("#"+b.id)[0],b.plural,b.phrase,0);return false})})};a.fn.mtDoPluginAction=function(c){var b=a.extend({},c);return this.each(function(){a(this).click(function(){doPluginAction(a("#"+b.id)[0],b.plural,b.phrase);return false})})};a.fn.mtRebasename=function(c){var b=a.extend({text:"..."},c);return this.each(function(){var d=a("input#basename"),
e=d.hide().val();d.hide().before('<span class="basename-text"></span>');d.parent("span.basename").after('<button id="mt-set-basename" class="mt-edit-field-button">'+b.edit+"</button>");b.basename?a("span.basename-text").text(b.basename):a("span.basename-text").text(e||b.text);a(this).keyup(function(){if(!b.basename){e=dirify(a(this).val());if(b.limit)e=e.substring(0,b.limit);a("span.basename-text").text(e||b.text);d.val(e)}});a("button#mt-set-basename").click(function(){a(this).hide();a("span.basename-text").hide();
a("input#basename").show();return false})})};a.fn.mtEditInput=function(c){var b=a.extend({save:"Save"},c);return this.each(function(){var d=a(this).attr("id"),e=a("input#"+d);if(e.val()&&!e.hasClass("show-input")){e.before('<span class="'+d+'-text"></span>').after('<button id="mt-set-'+d+'" class="mt-edit-field-button">'+b.edit+"</button>").hide();a("span."+d+"-text").text(e.val())}!e.val()&&e.hasClass("hide-input")&&e.before('<span class="'+d+'-text"></span>').after('<button id="mt-set-'+d+'" class="mt-edit-field-button">'+
b.edit+"</button>").hide();a("button#mt-set-"+d).click(function(){a(this).hide();a("span."+d+"-text").hide();a("input#"+d).show();a("p#"+d+"-warning").show();return false})})};a.fn.mtCheckboxOption=function(){return this.each(function(){var c=a(this).find(":checkbox"),b=c.attr("id");c.attr("checked")||a("div#"+b+"-option").hide();c.click(function(){a("div#"+b+"-option").toggle()})})};a.fn.mtToggleNext=function(c){var b=a.extend({click_class:"detail-link",detail_class:"detail"},c);return this.each(function(){var d=
a(this);a("."+b.detail_class).hide();d.find("."+b.click_class).click(function(e){d.toggleClass("active").find("."+b.detail_class).toggle();e.preventDefault()})})}})(jQuery);
